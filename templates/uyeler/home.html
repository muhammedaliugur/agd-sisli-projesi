{% extends 'base.html' %}
{% load static %}

{% block title %}Ana Sayfa | AGD Şişli{% endblock %}

{% block content %}

<div class="hero-v2 rounded-3 mb-5">
    <div class="hero-content-overlay">
        </div>
</div>

{% if request.user.is_authenticated %}
    {% if profil.rol == 'YETKILI' or profil.rol == 'BIRIM_BASKANI' %}
        <div class="mb-5" style="animation-delay: 0.2s;">
            <h3 class="mb-4 fw-light">Hızlı İşlemler</h3>
            <div class="row g-4">
                {% if profil.rol == 'YETKILI' %}
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'uyeler:uyeler' %}" class="text-decoration-none">
                        <div class="quick-action-card-v2">
                            <div class="icon-box text-warning"><i class="bi bi-person-check-fill"></i></div>
                            <div><h5 class="mb-1">Onay Bekleyenler</h5><p class="mb-0 text-muted">{{ onay_bekleyenler_sayisi }} yeni başvuru</p></div>
                        </div>
                    </a>
                </div>
                {% endif %}
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'uyeler:duyuru_ekle' %}" class="text-decoration-none">
                        <div class="quick-action-card-v2">
                            <div class="icon-box text-primary"><i class="bi bi-megaphone-fill"></i></div>
                            <div><h5 class="mb-1">Yeni Duyuru</h5><p class="mb-0 text-muted">Teşkilata duyuru yayınla</p></div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'uyeler:etkinlik_ekle' %}" class="text-decoration-none">
                        <div class="quick-action-card-v2">
                            <div class="icon-box text-success"><i class="bi bi-calendar-plus-fill"></i></div>
                            <div><h5 class="mb-1">Yeni Etkinlik</h5><p class="mb-0 text-muted">Yeni program planla</p></div>
                        </div>
                    </a>
                </div>
                <div class="col-lg-3 col-md-6">
                    <a href="{% url 'uyeler:not_defteri' %}" class="text-decoration-none">
                        <div class="quick-action-card-v2">
                            <div class="icon-box" style="color: #6f42c1;"><i class="bi bi-journal-bookmark-fill"></i></div>
                            <div><h5 class="mb-1">Not Defterim</h5><p class="mb-0 text-muted">Kişisel notlarına eriş</p></div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    {% endif %}
{% endif %}

<div class="row g-5">
    <div class="col-lg-7" style="animation-delay: 0.4s;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="mb-0 fw-light">Dernek Gündemi</h3>
           <a href="{% url 'uyeler:gundem' %}" class="btn-view-all">Tümünü Gör <i class="bi bi-arrow-right"></i></a>
        </div>
        {% for item in gundem_listesi %}
            <div class="card content-card mb-4">
                <div class="card-body">
                    {% if item.yayin_tarihi %}
                        <div class="mb-2"><span class="badge bg-primary-subtle text-primary-emphasis rounded-pill">Duyuru</span></div>
                        <h5 class="card-title">{{ item.baslik }}</h5>
                        <p class="card-text text-muted">{{ item.icerik|truncatewords:25 }}</p>
                        <small class="text-muted">{{ item.yayin_tarihi|timesince }} önce yayınlandı</small>
                    {% else %}
                        <div class="mb-2"><span class="badge bg-success-subtle text-success-emphasis rounded-pill">Etkinlik</span></div>
                        <h5 class="card-title">{{ item.baslik }}</h5>
                        <p class="card-text text-muted"><strong><i class="bi bi-geo-alt-fill"></i> Mekan:</strong> {{ item.mekan }}</p>
                        <small class="text-muted"><strong><i class="bi bi-calendar-event-fill"></i> Tarih:</strong> {{ item.tarih_saat|date:"d F Y, H:i" }}</small>
                    {% endif %}
                </div>
            </div>
        {% empty %}
            <div class="card content-card"><div class="card-body text-center text-muted">Henüz gündemde bir içerik bulunmamaktadır.</div></div>
        {% endfor %}
    </div>
    <div class="col-lg-5" style="animation-delay: 0.6s;">
        <h3 class="mb-4 fw-light">Galeriden Kareler</h3>
        {% if son_galeri_resimleri %}
            <div id="carouselExampleCaptions" class="carousel slide content-card" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    {% for fotograf in son_galeri_resimleri %}<button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="{{ forloop.counter0 }}" class="{% if forloop.first %}active{% endif %}" aria-current="true"></button>{% endfor %}
                </div>
                <div class="carousel-inner">
                    {% for fotograf in son_galeri_resimleri %}
                    <div class="carousel-item {% if forloop.first %}active{% endif %}">
                        <a href="{% url 'uyeler:album_detay' fotograf.album.id %}">
                            <img src="{{ fotograf.resim.url }}" class="d-block w-100" alt="{{ fotograf.album.baslik }}" style="aspect-ratio: 4/3; object-fit: cover;">
                            <div class="carousel-caption d-none d-md-block" style="background-color: rgba(0,0,0,0.5); border-radius: 0.5rem; padding: 0.5rem;">
                                <h5>{{ fotograf.album.baslik }}</h5><p>{{ fotograf.album.aciklama|truncatewords:10 }}</p>
                            </div>
                        </a>
                    </div>
                    {% endfor %}
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev"><span class="carousel-control-prev-icon" aria-hidden="true"></span><span class="visually-hidden">Önceki</span></button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next"><span class="carousel-control-next-icon" aria-hidden="true"></span><span class="visually-hidden">Sonraki</span></button>
            </div>
        {% else %}
            <div class="card content-card"><div class="card-body text-center text-muted">Henüz galeride resim bulunmamaktadır.</div></div>
        {% endif %}
    </div>
</div>

<section id="contact" class="contact-section">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-8">
                <div class="contact-form-wrapper">
                    
                    <div class="section-title">
                        <h2>İletişim & Konum</h2>
                        <p>İlçe merkezimizi ziyaret edebilir veya aşağıdaki formu doldurarak bize ulaşabilirsiniz.</p>
                    </div>

                    <div class="location-details mb-4">
                        <div class="map-container mb-3">
                            <iframe src="https://www.google.com/maps/embed?pb=!1m17!1m12!1m3!1d752.080815809232!2d28.974649269655558!3d41.0619260094021!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m2!1m1!2zNDHCsDAzJzQyLjkiTiAyOMKwNTgnMzEuMSJF!5e0!3m2!1str!2str!4v1760896554542!5m2!1str!2str" 
                                    width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                        </div>
                        <div class="address-item">
                            <i class="bi bi-geo-alt-fill"></i>
                            <span>Halide Edip Adıvar Mahallesi Babayiğit Sk. No9, Şişli/İstanbul</span>
                        </div>
                    </div>

                    <hr class="contact-divider">

                    <h4 class="form-title text-center">Mesaj Gönderin</h4>

                    {% if messages %}
                        {% for message in messages %}
                            <div class="alert {% if message.tags == 'success' %}alert-success{% else %}alert-warning{% endif %} alert-dismissible fade show text-center mt-3" role="alert">
                                {{ message }}
                                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                            </div>
                        {% endfor %}
                    {% endif %}

                    {% if user.is_authenticated %}
                        <form action="{% url 'uyeler:home' %}#contact" method="post" class="contact-form mt-4">
                            {% csrf_token %}
                            {{ form.honeypot }}
                            <div class="row">
                                <div class="col-md-6 form-group"><div class="input-group-icon"><i class="bi bi-person-fill"></i>{{ form.name }}</div></div>
                                <div class="col-md-6 form-group mt-3 mt-md-0"><div class="input-group-icon"><i class="bi bi-envelope-fill"></i>{{ form.contact_info }}</div></div>
                            </div>
                            <div class="form-group mt-3"><div class="input-group-icon"><i class="bi bi-chat-left-text-fill"></i>{{ form.subject }}</div></div>
                            <div class="form-group mt-3"><div class="input-group-icon"><i class="bi bi-pencil-fill"></i>{{ form.message }}</div></div>
                            <div class="text-center mt-4">
                                <button type="submit"><span>Mesajı Gönder</span><i class="bi bi-arrow-right-circle-fill"></i></button>
                            </div>
                        </form>
                        <div class="contact-info-box mt-4">
                            <a href="mailto:sislianadolugenclik@gmail.com" class="contact-info-item"><i class="bi bi-envelope-at-fill"></i><span>sislianadolugenclik@gmail.com</span></a>
                            <a href="tel:+905515958858" class="contact-info-item"><i class="bi bi-telephone-fill"></i><span>+90 (551) 595 88 58</span></a>
                        </div>
                    {% else %}
                       <div class="guest-prompt text-center mt-4">
    <div class="prompt-icon-wrapper">
        <i class="bi bi-shield-lock-fill prompt-icon"></i>
    </div>
    <p class="lead mb-4">İçeriği görmek ve mesaj gönderebilmek için lütfen üye girişi yapın.</p>
    
    <a href="{% url 'uyeler:register' %}" class="btn btn-primary btn-lg btn-register shadow-sm">
        <i class="bi bi-person-plus-fill me-2"></i>
        <span>Ücretsiz Kayıt Ol</span>
    </a>
    
    <p class="mt-3 text-muted">
        <small>Zaten üye misin? <a href="{% url 'uyeler:login' %}" class="login-link">Hemen Giriş Yap</a></small>
    </p>
</div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}